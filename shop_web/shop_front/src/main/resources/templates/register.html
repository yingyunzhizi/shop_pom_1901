<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="|${#request.getContextPath()}/|"/>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/login-register.css" />
    <title>Title</title>
    <script type="text/javascript"
            src="resources/scripts/jquery-1.8.3.min.js"></script>
    <!-- 依赖webuploader插件 -->
    <script type="text/javascript"
            src="resources/widget/webuploader/webuploader.min.js"></script>
    <link rel="stylesheet" href="resources/widget/webuploader/webuploader.css" type="text/css"
          media="screen" />
    <script>
        $(function () {
            // 初始化Web Uploader
            var uploader = WebUploader.create({

                // 选完文件后，是否自动上传。
                auto: true,

                swf: '/resources/widget/webuploader/Uploader.swf',

                // 文件接收服务端。
                server: '/res/uploadImg',

                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: '#filePicker',

                // 只允许选择图片文件。
                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/*'
                }
            });

            // 当有文件添加进来的时候
            uploader.on( 'fileQueued', function( file ) {

                // 创建缩略图
                // 如果为非图片文件，可以不用调用此方法。
                // thumbnailWidth x thumbnailHeight 为 100 x 100
                uploader.makeThumb( file, function( error, src ) {
                    //创建了缩略图
                    if ( src ) {
                        //alert("素略图创建 成功了");
                        //素略图创建成功
                        var html = "<img style='width: 100px;height: 100px;margin-right: 10px' src='"+src+"'/>";
                        $("#imgs_div").html(html);
                    }else {
                        alert("缩略去创建失败了");
                    }

                }, 100, 100 );
            });

            //如果成功的上传图片
            uploader.on( 'uploadSuccess', function(file,response) {

                if (response.code=="0000"){
                   /* var input = "<input type='hidden' name='header' value='"+response.filepath+"'/>";*/
                    $("#imgs").val(response.filepath);
                    //上传成功了
                    //alert(response.filepath);//将JSON对象
                } else {
                    alert(file.name+"图片上传失败了");
                }
            });
            var isUser = false;
            $("#username").blur(function () {
                var username = $("#username").val();
                if (username==""){
                    $("#span1").html("不能为空");
                    isUser = false;
                    return;
                }
                $.get("/user/checkByUsername?username="+username,"",function(data) {
                    $("#span1").html(data);
                    var value = $("#span1").html();
                    if (value != "√"){
                        debugger
                        isUser = false;
                    }else {
                        isUser = true;
                    }
                });
            });
            //提交的时候校验
            $("#btn").submit(function () {
                /*用户名标签自动触发blur事件*/
                $("#username").trigger("blur");
                return isUser;
            })
        })


    </script>
</head>
<body>
<div class="header wrap1000">
    <a href=""><img src="images/logo.png" alt="" /></a>
</div>

<div class="main">
    <div class="login-form fr">
        <div class="form-hd">
            <h3>用户注册</h3>
        </div>
        <div class="form-bd">
            <form action="/user/registerUser" method="POST" id="btn">
                <dl>
                    <dt>用户名</dt>
                    <dd>
                        <input type="text" name="username" class="text" id="username"/><br>
                        &nbsp;&nbsp;&nbsp;<span id="span1" style="color: red"></span>
                    </dd>
                </dl>
                <dl>
                    <dt>密码</dt>
                    <dd><input type="password" name="password" class="text"/></dd>
                </dl>
                <dl>
                    <dt>确认密码</dt>
                    <dd><input type="password" name="repwd" class="text"/></dd>
                </dl>
                <dl>
                    <dt>昵称</dt>
                    <dd><input type="text" name="nickname" class="text"/></dd>
                </dl>
                <dl>
                    <dt>邮箱</dt>
                    <dd><input type="text" name="email" class="text"/></dd>
                </dl>
                <dl>
                    <dd>选中头像</dd>
                    <dd>
                        <div id="imgs_div" style="padding: 10px;width: 600px; height: 200px; border: 1px solid #ff0000; margin-bottom: 10px;"></div>
                        <input type="hidden" id="imgs" name="header">
                        <div id="filePicker">选择图片</div>
                    </dd>
                </dl>
                <!--<dl>
                    <dt>验证码</dt>
                    <dd><input type="text" name="code" class="text" size="10" style="width:58px;"> <img src="images/code.png" alt="" align="absmiddle" style="position:relative;top:-2px;"/> <a href="" style="color:#999;">看不清，换一张</a></dd>
                </dl>-->
                <dl>
                    <dt>&nbsp;</dt>
                    <dd>
                        <input type= "checkbox" checked="checked"/>阅读并同意<a href="" class="forget">服务协议</a><br>
                        <input type="submit" value="立即注册" class="submit"/><br>
                        <span id="span2" style="color: red"></span>
                    </dd>  
                </dl>
            </form>

        </div>
        <div class="form-ft">

        </div>
    </div>

    <div class="login-form-left fl">
        <dl class="func clearfix">
            <dt>注册之后您可以</dt>
            <dd class="ico05"><i></i>购买商品支付订单</dd>
            <dd class="ico01"><i></i>申请开店销售商品</dd>
            <dd class="ico03"><i></i>空间好友推送分享</dd>
            <dd class="ico02"><i></i>收藏商品关注店铺</dd>
            <dd class="ico06"><i></i>商品资讯服务评价</dd>
            <dd class="ico04"><i></i>安全交易诚信无忧</dd>
        </dl>

        <div class="if">
            <h2>如果您是本站用户</h2>
            <p>我已经注册过账号，立即 <a href="" class="register">登录</a> 或是 <a href="" class="findpwd">找回密码？</a></p>
        </div>
    </div>
</div>

<div class="footer clear wrap1000">
    <p> <a href="">首页</a> | <a href="">招聘英才</a> | <a href="">广告合作</a> | <a href="">关于ShopCZ</a> | <a href="">联系我们</a></p>
    <p>Copyright 2004-2013 itcast Inc.,All rights reserved.</p>
</div>


</body>
</html>
